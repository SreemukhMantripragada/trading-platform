global:
  scrape_interval: 5s
  evaluation_interval: 5s
  scrape_timeout: 4s
  external_labels:
    env: local

rule_files:
  - /etc/prometheus/alert.rules.yml

scrape_configs:
  # 1) Prometheus self
  - job_name: prometheus
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: prometheus

  # 2) Application exporters
  #    Single source of truth is configs/metrics_endpoints.json
  #    Generated file for Prometheus: infra/prometheus/targets_apps.json
  - job_name: apps
    metrics_path: /metrics
    scheme: http
    scrape_timeout: 3s
    file_sd_configs:
      - files:
          - /etc/prometheus/targets_apps.json

  # 3) Kafka metrics (optional) — add a kafka-exporter container that exposes :9308
  - job_name: kafka
    static_configs:
      - targets: ['kafka-exporter:9308']
        labels: { service: kafka_exporter }
    relabel_configs:
      # Keep only if the target resolves; otherwise silently show 'down'
      - action: labelmap
        regex: __meta_.*

  # 4) Node / system (optional) — add a node-exporter container that exposes :9100
  - job_name: node
    static_configs:
      - targets: ['node-exporter:9100']
        labels: { service: node_exporter }
