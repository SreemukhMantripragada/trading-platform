global:
  scrape_interval: 5s
  evaluation_interval: 5s
  scrape_timeout: 4s
  external_labels:
    env: local

rule_files:
  - /etc/prometheus/alert.rules.yml

scrape_configs:
  # 1) Prometheus self
  - job_name: prometheus
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: prometheus

  # 2) Application exporters (Python services exposing /metrics via prometheus_client)
  #    NOTE (Docker Desktop on macOS): use host.docker.internal to reach host processes.
  - job_name: apps
    metrics_path: /metrics
    scheme: http
    scrape_timeout: 3s
    static_configs:
      - targets: ['host.docker.internal:8111']
        labels: { service: zerodha_ws }
      - targets: ['host.docker.internal:8112']
        labels: { service: bar_builder_1s }
      - targets: ['host.docker.internal:8113']
        labels: { service: bar_aggregator_multi }
      - targets: ['host.docker.internal:8114']
        labels: { service: pair_watch }
      - targets: ['host.docker.internal:8115']
        labels: { service: pairs_executor }
      - targets: ['host.docker.internal:8116']
        labels: { service: risk_manager }
      - targets: ['host.docker.internal:8117']
        labels: { service: paper_matcher }

  # 3) Kafka metrics (optional) — add a kafka-exporter container that exposes :9308
  - job_name: kafka
    static_configs:
      - targets: ['kafka-exporter:9308']
        labels: { service: kafka_exporter }
    relabel_configs:
      # Keep only if the target resolves; otherwise silently show 'down'
      - action: labelmap
        regex: __meta_.*

  # 4) Node / system (optional) — add a node-exporter container that exposes :9100
  - job_name: node
    static_configs:
      - targets: ['node-exporter:9100']
        labels: { service: node_exporter }
